<!-- Template Angular mis Ã  jour -->
<div class="category-strip">
  <div
    class="category-card"
    *ngFor="let cat of categoriesDisponibles"
    (mouseenter)="hoveredCategorie = cat.nom"
    (mouseleave)="hoveredCategorie = null"
    (click)="filtrerProduits(cat.nom)"
  >
    <img [src]="cat.image" [alt]="cat.nom" style="background: white;" />
    <span>{{ cat.nom }}</span>
  </div>
</div>

<div class="product-list" *ngIf="produitsFiltres.length > 0">
  <ng-container *ngFor="let produit of produitsFiltres">
    <div class="product-card informatique" (click)="Details(produit)" style="cursor: pointer;">
      
      <!-- Badge promo -->
      <div *ngIf="produit.prixPromotion > 0" class="promo-badge">
        Promo
      </div>

      <!-- IcÃ´ne coeur -->
      <fa-icon
        [icon]="estFavori(produit) ? faHeart : faHeartEmpty"
        class="top-right-icon"
        (click)="toggleFavori(produit);$event.stopPropagation()"
        [style.pointer-events]="!produit.enStock ? 'none' : 'auto'"
        [style.opacity]="!produit.enStock ? '0.4' : '1'"
        title="Ajouter aux favoris"
      ></fa-icon>

      <!-- Image produit -->
      <img [src]="produit.selectedImage || produit.image" [alt]="produit.nom" class="product-img" />

      <!-- Informations produit -->
      <div class="product-info">
        <h3>{{ produit.nom }}</h3>
        <p>{{ produit.description }}</p>
      </div>

  <!-- Prix avec indicateur stock (INVERSE) -->
<div class="price-stock-row">
  <!-- Indicateur de stock Ã  gauche -->
  <div class="stock-indicator" [class.in-stock]="produit.enStock">
    <span class="stock-emoji" *ngIf="produit.enStock">ðŸ˜Š</span>
    <span class="stock-emoji" *ngIf="!produit.enStock">ðŸ˜¢</span>
    <span *ngIf="produit.enStock">En stock</span>
    <span *ngIf="!produit.enStock">Rupture de stock</span>
  </div>

  <!-- Prix Ã  droite -->
  <div class="price-section">
    <div *ngIf="produit.prixPromotion > 0; else prixNormal">
      <div class="price-promo">{{ produit.prixPromotion }} MAD</div>
      <div class="price-original">{{ produit.prix }} MAD</div>
    </div>
    <ng-template #prixNormal>
      <div class="price">{{ produit.prix }} MAD</div>
    </ng-template>
  </div>
</div>


      <!-- Palette couleurs repositionnÃ©e -->
      <div class="color-palette" *ngIf="produit.couleurImages?.length; else emptyColorPalette">
        <div
          class="color-dot"
          *ngFor="let item of produit.couleurImages"
          [ngStyle]="{ 'background-color': item.color }"
          [class.selected]="produit.selectedColor === item.color"
          (click)="selectColorImage(produit, item.image, item.color);$event.stopPropagation()"
        ></div>
      </div>

      <ng-template #emptyColorPalette>
        <div class="color-palette placeholder"></div>
      </ng-template>

      <!-- Actions produit -->
      <div class="product-actions">
        <div class="right-icon">
          <fa-icon
            [icon]="faCartShopping"
            class="icon-action"
            (click)="ajouterAuPanier(produit);$event.stopPropagation()"
            [style.pointer-events]="!produit.enStock ? 'none' : 'auto'"
            [style.opacity]="!produit.enStock ? '0.4' : '1'"
            title="Ajouter au panier"
          ></fa-icon>
        </div>

        <div class="quantity-selector">
          <button (click)="decrementQuantite(produit.id);$event.stopPropagation()" class="qty-btn">âˆ’</button>
          <span class="qty-value">{{ quantites[produit.id] }}</span>
          <button (click)="incrementQuantite(produit.id);$event.stopPropagation()" class="qty-btn">+</button>
        </div>
      </div>

    </div>
  </ng-container>
</div>